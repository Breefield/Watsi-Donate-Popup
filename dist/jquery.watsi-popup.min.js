/*
 *  <%= pkg.title || pkg.name %> - v<%= pkg.version %>
 *  <%= pkg.description %>
 *  <%= pkg.homepage %>
 *
 *  Made by <%= pkg.author.name %>
 *  Under <%= pkg.licenses[0].type %> License
 */
!function(a){function b(b,e){this.el=b,this.$el=a(b),this.options=a.extend({},d,e),this._defaults=d,this._name=c,this.init()}Array.prototype.randomElement=function(){return this[Math.floor(Math.random()*this.length)]};var c="watsiDonatePopup",d={propertyName:"value"};b.prototype={init:function(){this.popup_align=this.$el.attr("watsi-align")||this.options.align||"top",this.buildPopupElement(),this.loadPatients(),this.$el.on("change",a.proxy(function(){this.positionPopup(),this.$popup.toggleClass("open",this.$el.prop("checked"))},this)),this.$popup.find(".patient-more-link").on("click",a.proxy(function(){this.$popup.removeClass("open")},this))},buildPopupElement:function(){var b='<div class="watsi-popup"><div class="info-bar section"><a href="https://watsi.org/" target="_blank"><img src="img/watsi-small.png" width="55"/></a><a class="more" href="https://watsi.org/" target="_blank">what is watsi?</a></div><div class="patient section cf"><h1 class="patient-title"></h1><img class="patient-photo" src=""/><p class="patient-summary"></p><a class="patient-more-link" href="" target="_blank">Donate</a></div></div>';this.$popup=a(b).insertBefore(this.$el),this.$popup.addClass("align-"+this.popup_align),this.$popup.parent().css("position","relative")},positionPopup:function(){var a=this.$el.position(),b=15;switch(this.popup_align){case"left":this.$popup.css({top:a.top+this.$el.outerHeight()/2-this.$popup.outerHeight()/2,left:a.left-b-this.$popup.outerWidth()});break;case"right":this.$popup.css({top:a.top+this.$el.outerHeight()/2-this.$popup.outerHeight()/2,left:a.left+this.$el.outerWidth()+b});break;case"bottom":this.$popup.css({top:a.top+this.$el.outerHeight()+b,left:a.left+this.$el.outerWidth()/2-this.$popup.outerWidth()/2});break;case"top":this.$popup.css({top:a.top-this.$popup.outerHeight()-b,left:a.left+this.$el.outerWidth()/2-this.$popup.outerWidth()/2})}},loadPatients:function(){a.ajax("http://watsi-api-proxy.herokuapp.com/?url=https://watsi.org/fund-treatments.json",{dataType:"jsonp",success:a.proxy(function(a){this.renderProfile(a.profiles.randomElement()),this.positionPopup(),this.$popup.addClass("loaded")},this)})},renderProfile:function(a){this.$popup.find(".patient-title").text("Fund "+a.name+"'s Treatment"),this.$popup.find(".patient-photo").attr("src",a.profile_url),this.$popup.find(".patient-summary").text(a.promo_description),this.$popup.find(".patient-more-link").attr("href",a.url+"?from=popup")}},a.fn[c]=function(d){return this.each(function(){a.data(this,"plugin_"+c)||a.data(this,"plugin_"+c,new b(this,d))})}}(jQuery,window,document);